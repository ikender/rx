$(document).ready(function(){ace.config.set("basePath","/vendor/rutorika/form/vendor/ace/src-noconflict/"),$(".rk-code-field").each(function(){var e=$(this),a=ace.edit(e.siblings(".rk-code").get(0));a.$blockScrolling=1/0;var t=e.data("mode")||"html",n=e.data("theme")||"textmate";a.setTheme("ace/theme/"+n),a.getSession().setMode("ace/mode/"+t),a.getSession().setValue(e.val()),a.getSession().on("change",function(){e.val(a.getSession().getValue())})})}),$(document).ready(function(){$(".rk-color-field").each(function(){var e=$(this),a=e.data("minicolors");a=$.extend({theme:"bootstrap"},a),e.minicolors(a)})}),$(function(){$(".rk-datetimepicker").each(function(){var e=$(this).find("input"),a=e.data("datetime");$(this).datetimepicker(a)})}),L.Icon.Default.imagePath="/vendor/rutorika/form/vendor/leaflet-0.7.5/images",$(document).ready(function(){function e(e){return e?e.split(":"):null}$(".rk-geopoint-field").each(function(){function a(e){o?o.setLatLng(e):(o=L.marker(e,{draggable:!0}).addTo(s),o.on("dragend",function(e){var t=this.getLatLng();a(t),i.val(t.lat+":"+t.lng)})),s.panTo(e)}function t(){o&&(s.removeLayer(o),o=null)}function n(e,a,t){var n=i.data("type")||t;return a.indexOf(n)<0&&(console.warn(e+" doesnt support `"+n+"` type. Only "+a.join(" | ")+". Fallback to "+t),n=t),n}var o,i=$(this),r=$(this).siblings(".rk-map"),l=i.data("layer")||"osm",d=$.extend({center:[51.476852,-498e-6],zoom:12},i.data("map")||{}),c=e(i.val());c&&(d.center=c);var s=new L.Map(r.get(0),d);c&&a(c);var p,u;switch(l){case"yandex":u=n("Yandex",["map","satellite","hybrid","publicMap","publicMapHybrid"],"publicMap"),p=new L.Yandex(u);break;case"osm":u=i.data("type")||"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",0!==u.indexOf("http")&&0!==u.indexOf("//")&&(console.warn("OSM doesnt support `"+u+"` type. Fallback to http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),u="http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"),p=new L.TileLayer(u);break;case"google":u=n("Google",["ROADMAP","SATELLITE","HYBRID","TERRAIN"],"ROADMAP"),p=new L.Google("ROADMAP");break;case"bing":u=n("Bing",["Road","Aerial","AerialWithLabels","Birdseye","BirdseyeWithLabels"],"Road"),p=new L.BingLayer("AvoUren6Dm0PAAyhkqPcEQs3PtNsC_VHqb2Pxyac59fd-YME_3FZ_6No4BL5iEAe",{type:u});break;default:console.warn("Layer `"+l+"` doesn't supported, you should use one of yandex, google, osm or bing. Fallback to OSM layer"),p=new L.TileLayer("http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png")}s.addLayer(p),i.on("change",function(){var n=i.val();if(n){var o=e(n);a(o)}else t()}),s.on("click",function(e){a(e.latlng),i.val(e.latlng.lat+":"+e.latlng.lng)})})}),$(".rk-select2").each(function(){function e(e){e.select2({theme:"bootstrap"})}var a=$(this),t=a.val(),n=a.data("value"),o=a.data("ajax--url");if(o&&n&&!t){var i=$.ajax({url:o+"/init",data:{ids:n}});i.then(function(t){t.results.forEach(function(e){var t=$("<option>").text(e.text).attr("value",e.id).prop("selected",!0);a.prepend(t)}),e(a)})}else e(a)}),$(document).ready(function(){$(".rk-upload-container .rk-upload-preview").magnificPopup({delegate:"a",type:"image"}),$(".rk-uploader-field").each(function(){function e(){var e=[];o.find(".rk-upload-item").each(function(){e.push($(this).data("filename"))}),a.val(e.join(":"))}var a=$(this),t=a.hasClass("rk-uploader-multiple-field"),n=a.siblings(".rk-upload-container"),o=n.find(".rk-upload-preview"),i=function(e,i){if(t){var r=$("#rk-item-template").html(),l=a.val();l+=(l?":":"")+e,a.val(l);var d=r.replace(/\{fileSrc}/g,i).replace(/\{filename}/g,e);o.append(d)}else a.val(e),n.find(".rk-upload-link").text(e).attr("href",i),o.find("a").attr("href",i),o.find("img,audio").attr("src",i)};n.find("input:file").fileupload({dataType:"json",url:a.data("url")||"/upload",paramName:"file",formData:[{name:"type",value:a.data("type")||"default"}],done:function(e,a){i(a.result.filename,a.result.path)},fail:function(e,a){console.error("Whooooops",e,a)}}),o.on("click",".rk-upload-remove",function(a){a.preventDefault(),t?($(this).parents(".rk-upload-item").remove(),e()):i("","")}),t&&o.sortable({handle:".sortable-handle",update:function(a,t){e()},cursor:"move"})})});